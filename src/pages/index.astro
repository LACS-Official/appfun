---
import Layout from '../layouts/Layout.astro';
import DynamicCarousel from '../components/ui/DynamicCarousel.astro';
import AllSoftwareGrid from '../components/software/AllSoftwareGrid.astro';
import SidebarTabs from '../components/react/SidebarTabs.tsx';

const title = '首页';
const description = 'APPFUN - 发现和下载最新最有趣的软件工具，包括工具软件、开发工具、设计软件、多媒体软件等多种分类，提供免费下载和详细的使用指南';
const keywords = '软件下载,免费软件,工具软件,开发工具,设计软件,多媒体软件,APPFUN,有趣软件';
const canonical = 'https://appfun.fun/';
const structuredData = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "APPFUN",
  "alternateName": "APPFUN.FUN",
  "url": "https://appfun.fun",
  "description": description,
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://appfun.fun/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  },
  "publisher": {
    "@type": "Organization",
    "name": "领创工作室",
    "url": "https://appfun.fun"
  }
};
---

<Layout 
  title={title} 
  description={description} 
  keywords={keywords}
  canonical={canonical}
  structuredDataType="website"
  structuredData={structuredData}
>
  <!-- 顶部主要区域 -->
  <section class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300 pb-12 pt-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- 左侧轮播图 (占2/3) -->
        <div class="lg:col-span-8">
          <DynamicCarousel
            websiteId={1}
            autoPlay={true}
            interval={5000}
            class="w-full aspect-[16/9] lg:aspect-[21/9] shadow-lg"
            limit={10}
          />
        </div>

        <!-- 右侧排行榜 (占1/3) -->
        <div class="lg:col-span-4 flex flex-col h-full">
          <SidebarTabs client:idle />
        </div>

      </div>
    </div>
  </section>

  <!-- 下部区域 -->
  <section class="bg-white dark:bg-gray-900 py-12 border-t border-gray-100 dark:border-gray-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
          <span class="bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 p-2 rounded-lg mr-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
          </span>
          全部软件
        </h2>
        <a href="/categories" class="text-sm font-medium text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors">
          浏览全部分类 &rarr;
        </a>
      </div>
      <AllSoftwareGrid limit={20} />
    </div>
  </section>

</Layout>

<!-- React 组件接管 Tab，无需脚本切换 -->

<script>
  import { initializeApiClient, getApiClient } from '../lib/api';
  import { apiConfig } from '../lib/config';

  // 初始化 API 客户端
  initializeApiClient(apiConfig);

  // 立即设置全局API客户端
  if (window) {
    window.apiClient = getApiClient();
  }

  // 仅初始化 API 客户端，React 组件内部自行拉取数据
</script>

<style>
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #e5e7eb;
    border-radius: 20px;
  }
  .dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #374151;
  }
</style>
